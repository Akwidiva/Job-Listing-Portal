<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forgot Password</title>
<link rel="stylesheet" href="script.css">
</head>
<body>
<div class="form-container">
    <h2>Forgot Password</h2>
    <form id="forgotForm">
        <input type="email" id="email" placeholder="Enter your registered email">
        <button type="submit">Send Reset Link</button>
        <div class="success" id="successMsg"></div>
        <div class="error" id="errorMsg"></div>
    </form>

    <!-- Manual link to registration -->
    <p style="text-align: center; margin-top: 20px;">
        <a href="registration.html" id="backToRegister" style="color: #0984e3; text-decoration: none; display:none;">Back to Registration</a>
    </p>
</div>

<script>
const form = document.getElementById("forgotForm");
const backLink = document.getElementById("backToRegister");

form.addEventListener("submit", async e => {
    e.preventDefault();
    const email = document.getElementById("email").value.trim();
    const successMsg = document.getElementById("successMsg");
    const errorMsg = document.getElementById("errorMsg");
    successMsg.style.display = "none"; 
    errorMsg.style.display = "none";
    backLink.style.display = "none";

    if (!email) {
        errorMsg.textContent = "Please enter your email!";
        errorMsg.style.display = "block";
        return;
    }

    try {
        const res = await fetch("http://localhost:5000/forgot-password", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email })
        });

        const result = await res.json();

        if (res.ok) {
            successMsg.innerHTML = `
                Reset link sent successfully!<br>
                <a href="${result.resetLink}" target="_blank"></a>
            `;
            successMsg.style.display = "block";
            backLink.style.display = "inline"; // Show manual link
        } else {
            errorMsg.textContent = result.error || "Failed to generate reset link";
            errorMsg.style.display = "block";
        }
    } catch (err) {
        errorMsg.textContent = "Server not responding!";
        errorMsg.style.display = "block";
    }
});
</script>
</body>
</html>
